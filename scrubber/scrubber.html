<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Natsuki Oneyama">
  <title>SCRAPBOOK_NATSUKI</title>
  <link rel="preconnect" href="https://use.typekit.net" crossorigin>
  <link rel="preconnect" href="https://p.typekit.net" crossorigin>
  <link rel="stylesheet" href="https://use.typekit.net/tar7poy.css">
  <link rel="stylesheet" href="scrubber.css">
  <link rel="icon" type="image/png" href="favicon.png">
  <link rel="apple-touch-icon" sizes="180x180" href="favicon.png">
</head>

<body>
  <div id="scrubber">
    <div class="frame">
<img id="frame"
  src="img/01.webp"
  data-path="img/"
  data-start="1"
  data-end="26"
  data-pad="2"
  data-ext="webp"
  decoding="async"
  loading="eager"
  >
   <div class="loading" id="loader">loading…</div>
    </div>
  </div>

  <a href="../index.html" id="info-btn" aria-label="Back" onclick="closeWindow(event)">← Back</a>

  

<script src="scrubber.js" defer></script>
<script>
function closeWindow(e) {
  e.preventDefault();
  // 現在のタブを閉じる試行
  window.open('', '_self'); // 自分自身を開く → window.close() を許可させる
  window.close();

  // もし閉じられなかった場合は fallback
  setTimeout(() => {
    if (!window.closed) {
      window.location.href = "../index.html";
    }
  }, 200);
}
</script>
<script>
(function () {
  const ua = navigator.userAgent || "";
  // Instagramアプリ内ブラウザを検出
  const inIG = ua.includes("Instagram");
  if (!inIG) return;

  // 現在のURLを取得
  const url = window.location.href;

  // iOS or Android 判定
  const isiOS = /iPhone|iPad|iPod/i.test(ua);
  const isAndroid = /Android/i.test(ua);

  // iOSならSafari、AndroidならChromeで開く
  if (isiOS) {
    window.location = "x-safari-" + url;
  } else if (isAndroid) {
    window.location = "intent://" + url.replace(/^https?:\/\//, "") +
      "#Intent;scheme=https;package=com.android.chrome;end";
  }
})();
</script>
<script>
(function () {
  // ========= 設定 =========
  const FPS = 10;          // 切替速度（低いほどスロー＆軽い）
  const DURATION = 3000;   // イントロ総時間(ms)

  // 既存のスクラブ関数があれば利用
  function callExistingSetter(i) {
    if (typeof window.scrubTo === 'function') { window.scrubTo(i); return true; }
    if (typeof window.setFrame === 'function') { window.setFrame(i); return true; }
    return false;
  }
  const pad = (n, d) => String(n).padStart(d, '0');

  window.addEventListener('load', () => {
    const img = document.getElementById('frame');
    if (!img) return;

    // アクセシビリティ：動きを減らす設定ならスキップ
    const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

    // info から戻ったらスキップ（1回だけ）
    const skip = sessionStorage.getItem('skipIntro') === '1';
    if (prefersReduced || skip) {
      sessionStorage.removeItem('skipIntro');
      const start = parseInt(img.dataset.start || '1', 10);
      const padN  = parseInt(img.dataset.pad   || '2', 10);
      const ext   = img.dataset.ext || 'webp';
      const path  = img.dataset.path || '';
      if (!callExistingSetter(start)) {
        img.src = path + pad(start, padN) + '.' + ext;
      }
      return;
    }

    // データ属性から並びを取得
    const path  = img.dataset.path || '';
    const start = parseInt(img.dataset.start || '1', 10);
    const end   = parseInt(img.dataset.end   || '1', 10);
    const padN  = parseInt(img.dataset.pad   || '2', 10);
    const ext   = img.dataset.ext || 'webp';

    // 先読み（最初の数枚）
    ['01','02','03','04'].forEach(n => {
      const pre = new Image();
      pre.src = path + n + '.' + ext;
    });

    let i = start;
    const stepMs = 1000 / FPS;
    let timer = setInterval(() => {
      if (!callExistingSetter(i)) {
        img.src = path + pad(i, padN) + '.' + ext;
      }
      i = (i < end) ? i + 1 : start;
    }, stepMs);

    // タブが非表示になったら省エネ停止
    document.addEventListener('visibilitychange', () => {
      if (document.hidden && timer) { clearInterval(timer); timer = null; }
    });

    // ラストをふっと消して静止（任意の小さな演出）
    setTimeout(() => {
      img.style.transition = 'opacity 500ms ease';
      img.style.opacity = '0';
    }, DURATION - 320);

    setTimeout(() => {
      if (timer) { clearInterval(timer); timer = null; }
      img.style.transition = 'none';
      img.style.opacity = '1';
      if (!callExistingSetter(start)) {
        img.src = path + pad(start, padN) + '.' + ext;
      }
    }, DURATION);
  });
})();
</script>

</body>
</html>


